var Autocomplete=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.webkitMatchesSelector?t.webkitMatchesSelector(e):null},i=function(t,e){return t.closest?t.closest(e):function(t,e){for(var n=t;n&&1===n.nodeType;){if(s(n,e))return n;n=n.parentNode}return null}(t,e)},o=function e(){var s,o=this,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=u.search,l=u.autoSelect,r=void 0!==l&&l,d=u.setValue,c=void 0===d?function(){}:d,h=u.setAttribute,p=void 0===h?function(){}:h,f=u.onUpdate,b=void 0===f?function(){}:f,v=u.onSubmit,g=void 0===v?function(){}:v,L=u.onShow,w=void 0===L?function(){}:L,y=u.onHide,S=void 0===y?function(){}:y,x=u.onLoading,m=void 0===x?function(){}:x,R=u.onLoaded,A=void 0===R?function(){}:R;t(this,e),n(this,"value",""),n(this,"searchCounter",0),n(this,"results",[]),n(this,"selectedIndex",-1),n(this,"handleInput",function(t){var e=t.target.value;o.updateResults(e),o.value=e}),n(this,"handleKeyDown",function(t){var e=t.key;switch(e){case"Up":case"Down":case"ArrowUp":case"ArrowDown":var n="ArrowUp"===e||"Up"===e?o.selectedIndex-1:o.selectedIndex+1;t.preventDefault(),o.handleArrows(n);break;case"Tab":o.selectResult();break;case"Enter":var s=o.results[o.selectedIndex];o.selectResult(),o.onSubmit(s);break;case"Esc":case"Escape":o.hideResults(),o.setValue();break;default:return}}),n(this,"handleFocus",function(t){var e=t.target.value;o.updateResults(e),o.value=e}),n(this,"handleBlur",function(){o.hideResults()}),n(this,"handleResultMouseDown",function(t){t.preventDefault()}),n(this,"handleResultClick",function(t){var e=t.target,n=i(e,"[data-result-index]");if(n){o.selectedIndex=parseInt(n.dataset.resultIndex,10);var s=o.results[o.selectedIndex];o.selectResult(),o.onSubmit(s)}}),n(this,"handleArrows",function(t){var e=o.results.length;o.selectedIndex=(t%e+e)%e,o.onUpdate(o.results,o.selectedIndex)}),n(this,"selectResult",function(){var t=o.results[o.selectedIndex];t&&o.setValue(t),o.hideResults()}),n(this,"updateResults",function(t){var e=++o.searchCounter;o.onLoading(),o.search(t).then(function(t){e===o.searchCounter&&(o.results=t,o.onLoaded(),0!==o.results.length?(o.selectedIndex=o.autoSelect?0:-1,o.onUpdate(o.results,o.selectedIndex),o.showResults()):o.hideResults())})}),n(this,"showResults",function(){o.setAttribute("aria-expanded",!0),o.onShow()}),n(this,"hideResults",function(){o.selectedIndex=-1,o.results=[],o.setAttribute("aria-expanded",!1),o.setAttribute("aria-activedescendant",""),o.onUpdate(o.results,o.selectedIndex),o.onHide()}),n(this,"checkSelectedResultVisible",function(t){var e=t.querySelector('[data-result-index="'.concat(o.selectedIndex,'"]'));if(e){var n=t.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<n.top?t.scrollTop-=n.top-s.top:s.bottom>n.bottom&&(t.scrollTop+=s.bottom-n.bottom)}}),this.search=(s=a,Boolean(s&&"function"==typeof s.then)?a:function(t){return Promise.resolve(a(t))}),this.autoSelect=r,this.setValue=c,this.setAttribute=p,this.onUpdate=b,this.onSubmit=g,this.onShow=w,this.onHide=S,this.onLoading=m,this.onLoaded=A},u=0,a=function(){function n(e,s,i){t(this,n),this.id="".concat(i,"-result-").concat(e),this.class="".concat(i,"-result"),this["data-result-index"]=e,this.role="option",e===s&&(this["aria-selected"]="true")}var s,i,o;return s=n,(i=[{key:"toString",value:function(){var t=this;return Object.keys(this).reduce(function(e,n){return"".concat(e," ").concat(n,'="').concat(t[n],'"')},"")}}])&&e(s.prototype,i),o&&e(s,o),n}();return function e(s){var i=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l.search,d=l.onSubmit,c=void 0===d?function(){}:d,h=l.baseClass,p=void 0===h?"autocomplete":h,f=l.autoSelect,b=l.getResultValue,v=void 0===b?function(t){return t}:b,g=l.renderResult;t(this,e),n(this,"expanded",!1),n(this,"loading",!1),n(this,"position",{}),n(this,"resetPosition",!0),n(this,"initialize",function(){i.root.style.position="relative",i.input.setAttribute("role","combobox"),i.input.setAttribute("autocomplete","off"),i.input.setAttribute("autocapitalize","off"),i.input.setAttribute("autocorrect","off"),i.input.setAttribute("spellcheck","false"),i.input.setAttribute("aria-autocomplete","list"),i.input.setAttribute("aria-haspopup","listbox"),i.input.setAttribute("aria-expanded","false"),i.resultList.setAttribute("role","listbox"),i.resultList.style.position="absolute",i.resultList.style.zIndex="1",i.resultList.style.width="100%",i.resultList.style.boxSizing="border-box",i.resultList.id||(i.resultList.id=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(t).concat(++u)}("".concat(i.baseClass,"-result-list-"))),i.input.setAttribute("aria-owns",i.resultList.id),document.body.addEventListener("click",i.handleDocumentClick),i.input.addEventListener("input",i.core.handleInput),i.input.addEventListener("keydown",i.core.handleKeyDown),i.input.addEventListener("focus",i.core.handleFocus),i.input.addEventListener("blur",i.core.handleBlur),i.resultList.addEventListener("mousedown",i.core.handleResultMouseDown),i.resultList.addEventListener("click",i.core.handleResultClick),i.updateStyle()}),n(this,"setAttribute",function(t,e){i.input.setAttribute(t,e)}),n(this,"setValue",function(t){i.input.value=t?i.getResultValue(t):""}),n(this,"renderResult",function(t,e){return"<li ".concat(e,">").concat(i.getResultValue(t),"</li>")}),n(this,"handleUpdate",function(t,e){var n,s,o,u;i.resultList.innerHTML="",t.forEach(function(t,n){var s=new a(n,e,i.baseClass),o=i.renderResult(t,s);"string"==typeof o?i.resultList.insertAdjacentHTML("beforeend",o):i.resultList.insertAdjacentElement("beforeend",o)}),i.input.setAttribute("aria-activedescendant",e>-1?"".concat(i.baseClass,"-result-").concat(e):""),i.resetPosition&&(i.resetPosition=!1,i.position=(n=i.input,s=i.resultList,o=n.getBoundingClientRect(),u=s.getBoundingClientRect(),o.bottom+u.height>window.innerHeight&&window.innerHeight-o.bottom<o.top&&window.pageYOffset+o.top-u.height>0?"above":"below"),i.updateStyle()),i.core.checkSelectedResultVisible(i.resultList)}),n(this,"handleShow",function(){i.expanded=!0,i.updateStyle()}),n(this,"handleHide",function(){i.expanded=!1,i.resetPosition=!0,i.updateStyle()}),n(this,"handleLoading",function(){i.loading=!0,i.updateStyle()}),n(this,"handleLoaded",function(){i.loading=!1,i.updateStyle()}),n(this,"handleDocumentClick",function(t){i.root.contains(t.target)||i.core.hideResults()}),n(this,"updateStyle",function(){i.root.dataset.expanded=i.expanded,i.root.dataset.loading=i.loading,i.root.dataset.position=i.position,i.resultList.style.visibility=i.expanded?"visible":"hidden",i.resultList.style.pointerEvents=i.expanded?"auto":"none","below"===i.position?(i.resultList.style.bottom=null,i.resultList.style.top="100%"):(i.resultList.style.top=null,i.resultList.style.bottom="100%")}),this.root="string"==typeof s?document.querySelector(s):s,this.input=this.root.querySelector("input"),this.resultList=this.root.querySelector("ul"),this.baseClass=p,this.getResultValue=v,"function"==typeof g&&(this.renderResult=g),this.core=new o({search:r,autoSelect:f,setValue:this.setValue,setAttribute:this.setAttribute,onUpdate:this.handleUpdate,onSubmit:c,onShow:this.handleShow,onHide:this.handleHide,onLoading:this.handleLoading,onLoaded:this.handleLoaded}),this.initialize()}}();
